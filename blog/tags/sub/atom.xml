<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: sub | 唔好巨集]]></title>
  <link href="http://openkorer.github.com/blog/tags/sub/atom.xml" rel="self"/>
  <link href="http://openkorer.github.com/"/>
  <updated>2013-04-07T23:07:34+08:00</updated>
  <id>http://openkorer.github.com/</id>
  <author>
    <name><![CDATA[openkorer]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[利用Perl Sub產生excel報告]]></title>
    <link href="http://openkorer.github.com/blog/2013/04/07/write2file/"/>
    <updated>2013-04-07T21:52:00+08:00</updated>
    <id>http://openkorer.github.com/blog/2013/04/07/write2file</id>
    <content type="html"><![CDATA[<p>[openkore]: http://www.openkore.com
[XKore]: http://www.openkore.com/index.php/XKore
[config.txt]: http://www.openkore.com/index.php/Category:Config.txt
[automacro]: http://wiki.openkore.com/index.php?title=Macro_plugin#Automacros
[items_control.txt]: http://www.openkore.com/index.php/Items_control.txt
[DS]: http://dsfix.org
[p]: http://www.openkore.com/index.php/P
[Console Command]: http://www.openkore.com/index.php/Category:Console_Command
[autostorage]: http://www.openkore.com/index.php/Autostorage
[move]: http://www.openkore.com/index.php/Move
[storageAuto_npc]: http://www.openkore.com/index.php/StorageAuto_npc
[itemsMaxWeight]: http://www.openkore.com/index.php/ItemsMaxWeight
[itemsMaxWeight_sellOrStore]: http://www.openkore.com/index.php/ItemsMaxWeight_sellOrStore
[itemsMaxNum_sellOrStore]: http://www.openkore.com/index.php/ItemsMaxNum_sellOrStore
[storage]: http://www.openkore.com/index.php/Storage
[一次控制多個openkore]: http://openkorer.github.com/blog/2013/03/25/sync
[data.grf]: file:///C:/Program%20Files%20(x86)/Gravity/RO/
[dealAuto]: http://www.openkore.com/index.php/DealAuto
[dealAuto_names]: http://www.openkore.com/index.php/DealAuto_names</p>

<p>爬塔結束時大家最想知道什麼，大概是以下三點吧?</p>

<ol>
<li>誰撿了什麼？</li>
<li>什麼時侯撿？</li>
<li>撿了多少次？</li>
</ol>


<p>今天教大家利用perl sub產生excel報告</p>

<ul>
<li><a href="#partyitemlog">partyitemlog</a>偵測隊伍成員撿了什麼</li>
<li><a href="#write2file">write2file</a>把資料寫入檔案裡。</li>
</ul>


<p><a name="partyitemlog"></a>
``` perl partyitemlog
automacro partyitemlog {
  console /隊伍成員 (.<em>) 撿取了物品 (.</em>)/
  call {</p>

<pre><code>write2file("$.map","$.lastMatch1","$.lastMatch2")   #　呼叫perl sub並將地圖，人物，物品資料傳送
</code></pre>

<p>  }
}
```</p>

<p><a name="write2file"></a>
``` perl write2file
sub write2file {</p>

<pre><code>my ($map, $name, $desc) = @_;           # 把partyitemlog送來的資料代入$map,$name,$desc
open(FILE, "&gt;&gt;:utf8", "$Settings::logs_folder/partyitem.csv"); # 打開logs資料夾下的csv檔，如沒有會自動產生。
my @date  = localtime time;             # 讀取這一刻日期跟時間
$date[5] += 1900;
$date[4] += 1;
my $time = sprintf(
"%04d-%02d-%02d %02d:%02d:%02d",        # 自訂格式，個人比較喜歡用YYYY-MM-DD HH:MM:SS
$date[5],$date[4],$date[3],$date[2],$date[1],$date[0]);     # 對應格式
my $log = "$time,$map,$name,$desc\n";   # 自訂資料格式跟次序
print FILE $log;                        # 把資料寫入檔案
close(FILE);                            # 關閉檔案
</code></pre>

<p>}
```</p>

<p>以下是利用notepad打開partyitem.csv檔案的範本，符號","在excel csv是分隔作用。</p>

<pre><code>    2013-04-05 18:42:47,1@tower23,隊員A,變形長靴
    2013-04-05 18:42:56,1@tower23,隊員B,血斧
    2013-04-05 18:42:58,1@tower55,隊員A,獸人英雄卡片
</code></pre>

<p>用excel直接開會如圖下</p>

<p><img src="/images/partyitemcsv.jpg" alt="" /></p>

<p>只要在第一行加入標示然後選擇，再按filter。</p>

<p><img src="/images/partyitemcsv2.jpg" alt="" /></p>
]]></content>
  </entry>
  
</feed>
